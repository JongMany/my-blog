---
title: 시장/지정가 주문을 위한 차트 내 UI
summary: 가격축 지정가·인-차트 시장가 주문 UX. iframe 내부에 Web Components(Lit) 삽입, 번들 URL 동적 로딩 아키텍처 설계.
project: Coinness
order: 6.0
tags: [Web Components, Lit, iframe, Vite, TradingView]
date: 2025-01-10
cover: /projects/thumbnails/gifs/order.gif
coverAlt: "차트 내 주문 UI 데모"
coverCaption: "차트에서 직접 시장가/지정가 주문을 할 수 있는 UI"
coverType: gif
coverAspectRatio: 16:9
---

## 개요

차트에서 직접 거래할 수 없어 별도 거래 패널로 이동해야 하는 번거로움을 해결하기 위해 차트 내에서 시장가/지정가 주문을 쉽게 할 수 있는 UI를 개발했습니다.

## 배경/문제

- **사용자 경험 저하**: 차트에서 직접 거래할 수 없어 별도 거래 패널로 이동해야 하는 번거로움으로 거래 기회 상실
- **정보 분리 문제**: 실시간 가격 정보와 거래 기능이 분리되어 직관적인 거래 의사결정 방해
- **기술적 제약**: TradingView가 iframe으로 렌더링되어 React 컴포넌트를 직접 삽입할 수 없는 구조적 한계
- **복잡한 통신**: iframe과 메인 앱 간 DOM 조작 및 이벤트 처리의 복잡성

## 해결 방안

### Web Components 기반 Lit 라이브러리 도입

Vanilla JS에 비해 선언적 렌더링과 반응형 상태 관리, 생명주기 관리에 장점이 있어 Lit 라이브러리를 선택했습니다.

### iframe과 메인 앱 간 안정적인 상태 동기화 시스템 구축

EventBus 패턴을 통한 iframe과 메인 앱 간 실시간 양방향 통신을 구현했습니다.

### 모듈화된 아키텍처 설계

- **Orchestrator Layer**: 외부 의존성 주입, Panel 라이프 사이클 관리
- **View Layer**: UI 렌더링 및 이벤트 처리
- **Service Layer**: 거래 관련 비즈니스 로직 처리
- **Infrastructure Layer**: iframe DOM 접근

## 기술적 구현

### Lit 기반 Web Components 아키텍처

- Vanilla JS 대비 선언적 렌더링, 반응형 상태 관리, 생명주기 관리의 장점을 확인하여 도입
- 커스텀 엘리먼트 등록 완료까지 Promise 기반 대기 메커니즘 구현

### Vite manifest 기반 동적 경로 해석

- 빌드 시 생성되는 manifest.json을 활용해 실제 번들 경로를 동적으로 탐지하여 환경별 해시 청크 경로 차이를 해결
- 개발/배포 환경별 분기 로딩 전략으로 모든 환경에서 일관된 거래 패널 동작 보장

## 결과

- 차트에서 원클릭 거래 가능을 통해 사용자 거래 편의성 대폭 향상
- 환경 별 로딩 실패율 0% 달성
- 모든 환경에서 일관된 거래 패널 동작 보장
